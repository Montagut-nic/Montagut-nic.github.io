function updateURLString(){if(initComplete){var e="#";e+="sp="+$("#starting-points-input").val(),e+="&rp="+$("#reserved-points-input").val();for(var a=1;a<=10;a++)e+="&id"+a+"="+ideas[a-1].id,e+="&lv"+a+"="+ideaCurrentLevels[a-1],a<10&&(e+="&");window.history.pushState(null,null,e)}}function getHashVariable(e){for(var a=window.location.hash.substring(1),t=a.split("&"),i=0;i<t.length;i++){var s=t[i].split("=");if(s[0]==e)return s[1]}return!1}function getIdeasFromURL(){var e,a,t;$("#starting-points-input").val(0!=getHashVariable("sp")?getHashVariable("sp"):200),$("#reserved-points-input").val(0!=getHashVariable("rp")?getHashVariable("rp"):0);for(var i=0;i<10;i++)9==i&&(initComplete=!0),e=getHashVariable("id"+(i+1)),a=getHashVariable("lv"+(i+1)),0==e||0==a?randomizeIdea(i):(t=IdeasArray.filter(function(a){return a.id==e}),ideas[i]=t[0],ideaSelects[i].val(ideas[i].name),ideaSelects[i].change(),levelButtons[i][a-1].prop("checked",!0),levelButtons[i][a-1].button("refresh"),levelButtons[i][a-1].change())}function randomizeIdea(e){var a;do a=IdeasArray[Math.floor(Math.random()*IdeasArray.length)];while(ideas.indexOf(a)!=-1);ideas[e]=a,ideaSelects[e].val(a.name).change()}function addSignToValues(e){return e>0?"+"+e:e}function getMaxIdeaLevel(e){return null!=e.cost4?4:null!=e.cost3?3:null!=e.cost2?2:1}function getFloatFromPercentage(e){return Math.round(100*parseFloat(e.replace("%","")))/100}function evaluateExcessIdeasInGroup(e,a){var t="Si más del 50% de los niveles de ideas pertenecen al mismo grupo, esas ideas costarán más!";initComplete&&(e>50?($(a).css("background-color","#ffa8a8"),$(a).css("color","#000000"),$(a).attr("title",t),toastr.warning(t,"Más del 50% en un mismo grupo de ideas")):($(a).css("background-color","#201913"),$(a).css("color","#f9f6da"),$(a).attr("title","")))}function evaluateExcessMultiplier(){var e=parseInt($("#total-idea-levels-adm").text()),a=parseInt($("#total-idea-levels-dip").text()),t=parseInt($("#total-idea-levels-mil").text()),i=Math.max(e,a,t)/(e+a+t);return i>.5?5*(i-.5):0}function updateAvailablePoints(){for(var e=0,a=0;a<10;a++)e+=parseFloat(costValues[a].val());$("#available-points-value").val(Math.floor($("#starting-points-input").val()-$("#reserved-points-input").val()-e)),$("#available-points-value").val()<0?($("#available-points-value").css("background-color","#ffa8a8"),toastr.error("Has gastado más puntos que los que hay disponibles","Puntos Negativos")):$("#available-points-value").css("background-color","#f9f6da")}function updateIdeaGroupLevels(){for(var e=0,a=0,t=0,i=0,s=0;s<ideas.length;s++){var l=Math.floor(10*ideaCurrentLevels[s]/getMaxIdeaLevel(ideas[s]));"adm"==ideas[s].group?e+=l:"dip"==ideas[s].group?a+=l:"mil"==ideas[s].group&&(t+=l),i+=l}var r=Math.round(e/i*1e3)/10,o=Math.round(a/i*1e3)/10,n=Math.round(t/i*1e3)/10;$("#total-idea-levels-adm").text(r+"%"),$("#total-idea-levels-dip").text(o+"%"),$("#total-idea-levels-mil").text(n+"%"),evaluateExcessIdeasInGroup(r,"#total-idea-levels-adm"),evaluateExcessIdeasInGroup(o,"#total-idea-levels-dip"),evaluateExcessIdeasInGroup(n,"#total-idea-levels-mil")}function changeIdeaLevel(e,a){ideaCurrentLevels[e]=a,updateIdeaGroupLevels(),null!=ideas[e].valuePerLevel?isNaN(ideas[e].valuePerLevel)?modifierValues[e].val(addSignToValues(ideas[e].valuePerLevel)):modifierValues[e].val(addSignToValues(ideas[e].valuePerLevel*ideaCurrentLevels[e])):modifierValues[e].val(addSignToValues(ideas[e].percentagePerLevel*ideaCurrentLevels[e])+"%"),adjustIdeaCosts(),updateAvailablePoints(),updateURLString()}function adjustIdeaCosts(){for(var e,a,t=evaluateExcessMultiplier(),i=0;i<10;i++){switch(ideaCurrentLevels[i]){case 1:e=ideas[i].cost1;break;case 2:e=ideas[i].cost2;break;case 3:e=ideas[i].cost3;break;case 4:e=ideas[i].cost4}a=e*costModifierByOrder[i]+e*t,costValues[i].val(Math.round(10*a)/10+" points")}}var imgPlaceholders=[],ideaSelects=[],costValues=[],modifierValues=[],levelButtons=[],ideas=[],ideaCurrentLevels=[],initComplete=!1;toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:"200",hideDuration:"700",timeOut:"4000",extendedTimeOut:"300",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},jQuery(function(e){e("#accordion").accordion({collapsible:!0}),e(".ideaLvlRadioButtons").buttonset(),e(".ideaRandomizer").button({icons:{primary:"ui-icon-shuffle"},text:!1}),e(".hashRefresher").button({}),AdmIdeasArray.sort(compare),DipIdeasArray.sort(compare),MilIdeasArray.sort(compare),IdeasArray=AdmIdeasArray.concat(DipIdeasArray).concat(MilIdeasArray);for(var a=0;a<10;a++){imgPlaceholders.push(e("#img-placeholder-"+(a+1))),ideaSelects.push(e("#idea-"+(a+1)+"-selector")),modifierValues.push(e("#value-modifier-idea-"+(a+1))),costValues.push(e("#value-cost-idea-"+(a+1))),levelButtons.push([]);for(var t=1;t<=4;t++)levelButtons[a].push(e("#radio-idea-"+(a+1)+"-lv"+t));ideas.push(IdeasArray[0]),ideaCurrentLevels.push(1)}e(".ideaRandomizer").click(function(){var e=this.id.split("-");randomizeIdea(e[1]-1)}),e(".hashRefresher").click(function(){updateURLString()}),e("#points-selector").change(function(){e("#starting-points-input").val(e(this).val().substring(0,3)),updateAvailablePoints()}),e("#starting-points-input,#reserved-points-input").change(function(){updateAvailablePoints()}),e(".idea-row .ideaLvlRadioButtons input").change(function(){var e=this.id.split("-");changeIdeaLevel(e[2]-1,parseInt(e[3].replace("lv","")))}),e("[id^=idea-]").each(function(a,t){var i=null;IdeasArray.forEach(function(e,t,s){e.id.substring(0,3)!=i&&(e.id.indexOf("adm")!=-1?ideaSelects[a].append('<optgroup class="select-group-label" label="Administrative">'):e.id.indexOf("dip")!=-1?ideaSelects[a].append('<optgroup class="select-group-label" label="Diplomatic">'):e.id.indexOf("mil")!=-1&&ideaSelects[a].append('<optgroup class="select-group-label" label="Military">')),i=e.id.substring(0,3);var l='<option val="'+e.id+'">'+e.name+"</option>";ideaSelects[a].append(l)}),ideaSelects[a].change(function(){var a=e(this).attr("id").split("-")[1]-1,t=e(this).find(":selected").attr("val"),i=IdeasArray.filter(function(e){return e.id==t});ideas[a]=i[0];for(var s=0;s<4;s++)null!=ideas[a]["cost"+(s+1)]?(levelButtons[a][s].button("enable"),levelButtons[a][s].css("color","#000000")):(levelButtons[a][s].button("disable"),levelButtons[a][s].css("color","#dddddd"));levelButtons[a][0].prop("checked",!0),levelButtons[a][0].button("refresh"),"adm"==ideas[a].group?imgPlaceholders[a].attr("src","img/adm-point-bg.png"):"dip"==ideas[a].group?imgPlaceholders[a].attr("src","img/dip-point-bg.png"):imgPlaceholders[a].attr("src","img/mil-point-bg.png"),changeIdeaLevel(a,parseInt(1))})}),e("#points-selector").change(),getIdeasFromURL()});